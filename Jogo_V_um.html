<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Jogo Versao 1.0</title>
<style>
body {
  background: radial-gradient(circle at top, #020024, #000);
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}
#jogo {
  width:80%;
  height: 80%;
}
</style>
</head>
<body>

<canvas id="jogo"></canvas>

<script>
const jogo = document.getElementById("jogo");
const ctx = jogo.getContext("2d");
jogo.width = 400;
jogo.height = 150;

// ================== INPUT ==================
window.addEventListener("keydown", e => {
  if (e.code === "ArrowLeft" || e.code === "KeyA")
    jogador.posicao_largura -= jogador.velocidade;

  if (e.code === "ArrowRight" || e.code === "KeyD")
    jogador.posicao_largura += jogador.velocidade;
});

// ================== JOGADOR ==================
var jogador = {
  largura: 20,
  altura: 20,
  posicao_largura: 10,
  posicao_altura: 100,
  velocidade: 5,
  vidas: 3,
  vivo: true,
  invencivel: false,
  tempoInvencivel: 0,

  desenha() {
    ctx.fillStyle = this.invencivel ? "red" : "#a69c9c";
    ctx.fillRect(this.posicao_largura, this.posicao_altura, this.largura, this.altura);
  },

  colisaoTela() {
    if (this.posicao_largura < 0) this.posicao_largura = 0;
    if (this.posicao_largura + this.largura > jogo.width)
      this.posicao_largura = jogo.width - this.largura;
  },

  dano() {
    if (this.invencivel) return;

    this.vidas--;
    this.invencivel = true;
    this.tempoInvencivel = 60;

    criarParticulas(
      this.posicao_largura + this.largura / 2,
      this.posicao_altura + this.altura / 2
    );

    if (this.vidas <= 0) {
      this.vivo = false;
      alert("GAME OVER");
    }
  }
};

// ================== CENÁRIO ==================
var ceu = {
  desenha() {
    ctx.fillStyle = "#040542";
    ctx.fillRect(0, 0, jogo.width, jogo.height);
  }
};

var chao = {
  desenha() {
    ctx.fillStyle = "#026b19";
    ctx.fillRect(0, 120, jogo.width, 30);
  }
};

// ================== INIMIGOS ==================
let inimigos = [];
let tempoSpawn = 0;
let intervaloSpawn = 30;
let velocidadeBase = 4;

function criarInimigo() {
  inimigos.push({
    largura: 10,
    altura: 10,
    x: Math.random() * (jogo.width - 10),
    y: -10,
    velocidade: velocidadeBase,
    cor: "black"
  });
}

function atualizarInimigos() {
  for (let i = inimigos.length - 1; i >= 0; i--) {
    inimigos[i].y += inimigos[i].velocidade;

    // colisão jogador
    if (
      inimigos[i].x < jogador.posicao_largura + jogador.largura &&
      inimigos[i].x + inimigos[i].largura > jogador.posicao_largura &&
      inimigos[i].y < jogador.posicao_altura + jogador.altura &&
      inimigos[i].y + inimigos[i].altura > jogador.posicao_altura
    ) {
      jogador.dano();
      inimigos.splice(i, 1);
      continue;
    }

    if (inimigos[i].y > jogo.height) {
      inimigos.splice(i, 1);
    }
  }
}

function desenharInimigos() {
  inimigos.forEach(i => {
    ctx.fillStyle = i.cor;
    ctx.fillRect(i.x, i.y, i.largura, i.altura);
  });
}

// ================== PARTÍCULAS ==================
let particulas = [];

function criarParticulas(x, y) {
  for (let i = 0; i < 10; i++) {
    particulas.push({
      x, y,
      vx: (Math.random() - 0.5) * 4,
      vy: (Math.random() - 0.5) * 4,
      vida: 30
    });
  }
}

function atualizarParticulas() {
  for (let i = particulas.length - 1; i >= 0; i--) {
    let p = particulas[i];
    p.x += p.vx;
    p.y += p.vy;
    p.vida--;

    ctx.fillStyle = "yellow";
    ctx.fillRect(p.x, p.y, 2, 2);

    if (p.vida <= 0) particulas.splice(i, 1);
  }
}

// ================== HUD ==================
var menu = {
  desenha() {
    ctx.fillStyle = "#f2c705";
    ctx.font = "10px Arial";
    ctx.fillText("Vidas: " + jogador.vidas, 5, 10);
    ctx.fillText("Inimigos: " + inimigos.length, 300, 10);
  }
};

// ================== LOOP ==================
function jogo_loop() {
  ctx.clearRect(0, 0, jogo.width, jogo.height);

  ceu.desenha();
  chao.desenha();

  jogador.desenha();
  jogador.colisaoTela();

  atualizarInimigos();
  desenharInimigos();

  atualizarParticulas();
  menu.desenha();

  // invencibilidade
  if (jogador.invencivel) {
    jogador.tempoInvencivel--;
    if (jogador.tempoInvencivel <= 0) jogador.invencivel = false;
  }

  // spawn progressivo
  tempoSpawn++;
  if (tempoSpawn >= intervaloSpawn) {
    criarInimigo();
    tempoSpawn = 0;

    if (intervaloSpawn > 20) intervaloSpawn--;
    velocidadeBase += 0.02;
  }

  if (jogador.vivo) requestAnimationFrame(jogo_loop);
}

jogo_loop();
</script>
</body>
</html>
